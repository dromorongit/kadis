<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2"><i class="fas fa-box me-2"></i>Products</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <div class="btn-group me-2">
            <a href="/products/new" class="btn btn-primary">
                <i class="fas fa-plus me-1"></i>Add Product
            </a>
        </div>
    </div>
</div>

<!-- Filters -->
<div class="card mb-4">
    <div class="card-body">
        <form method="GET" class="row g-3">
            <div class="col-md-4">
                <label for="search" class="form-label">Search</label>
                <input type="text" class="form-control" id="search" name="search"
                       value="<%= query.search || '' %>" placeholder="Search products...">
            </div>
            <div class="col-md-3">
                <label for="category" class="form-label">Category</label>
                <select class="form-select" id="category" name="category">
                    <option value="">All Categories</option>
                    <option value="Men" <%= query.category === 'Men' ? 'selected' : '' %>>Men</option>
                    <option value="Women" <%= query.category === 'Women' ? 'selected' : '' %>>Women</option>
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label">&nbsp;</label>
                <button type="submit" class="btn btn-outline-primary d-block">
                    <i class="fas fa-search me-1"></i>Filter
                </button>
            </div>
            <div class="col-md-2">
                <label class="form-label">&nbsp;</label>
                <a href="/products" class="btn btn-outline-secondary d-block">
                    <i class="fas fa-times me-1"></i>Clear
                </a>
            </div>
        </form>
    </div>
</div>

<!-- Products Table -->
<div class="card">
    <div class="card-header">
        <h5 class="mb-0">All Products (<%= totalProducts %>)</h5>
    </div>
    <div class="card-body">
        <% if (products.length > 0) { %>
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Image</th>
                            <th>Title</th>
                            <th>Category</th>
                            <th>Brand</th>
                            <th>Price</th>
                            <th>Stock</th>
                            <th>Featured</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% products.forEach(product => { %>
                            <tr>
                                <td>
                                    <% if (product.images && product.images.length > 0) { %>
                                        <img src="<%= product.images[0] %>" alt="<%= product.title %>"
                                             class="product-thumbnail">
                                    <% } else { %>
                                        <div class="no-image">No Image</div>
                                    <% } %>
                                </td>
                                <td>
                                    <strong><%= product.title %></strong>
                                    <br><small class="text-muted"><%= product.id %></small>
                                </td>
                                <td>
                                    <span class="badge bg-<%= product.category === 'Men' ? 'info' : 'warning' %>">
                                        <%= product.category %>
                                    </span>
                                </td>
                                <td><%= product.brand %></td>
                                <td>â‚µ<%= product.price %></td>
                                <td>
                                    <% if (product.stockQuantity === 0) { %>
                                        <span class="badge bg-danger">Out of Stock</span>
                                    <% } else if (product.stockQuantity < 10) { %>
                                        <span class="badge bg-warning"><%= product.stockQuantity %></span>
                                    <% } else { %>
                                        <span class="badge bg-success"><%= product.stockQuantity %></span>
                                    <% } %>
                                </td>
                                <td>
                                    <% if (product.featured) { %>
                                        <i class="fas fa-star text-warning"></i>
                                    <% } else { %>
                                        <i class="far fa-star text-muted"></i>
                                    <% } %>
                                </td>
                                <td>
                                    <span class="badge bg-<%= product.isActive ? 'success' : 'secondary' %>">
                                        <%= product.isActive ? 'Active' : 'Inactive' %>
                                    </span>
                                </td>
                                <td>
                                    <div class="btn-group" role="group">
                                        <a href="/products/<%= product.id %>/edit" class="btn btn-sm btn-outline-primary">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                        <form method="POST" action="/products/<%= product.id %>?_method=DELETE"
                                              class="d-inline" onsubmit="return confirm('Are you sure you want to delete this product?')">
                                            <button type="submit" class="btn btn-sm btn-outline-danger">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </form>
                                    </div>
                                </td>
                            </tr>
                        <% }) %>
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <% if (totalPages > 1) { %>
                <nav aria-label="Products pagination" class="mt-4">
                    <ul class="pagination justify-content-center">
                        <% if (currentPage > 1) { %>
                            <li class="page-item">
                                <a class="page-link" href="?page=<%= currentPage - 1 %><%= query.search ? '&search=' + query.search : '' %><%= query.category ? '&category=' + query.category : '' %>">
                                    Previous
                                </a>
                            </li>
                        <% } %>

                        <% for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) { %>
                            <li class="page-item <%= i === currentPage ? 'active' : '' %>">
                                <a class="page-link" href="?page=<%= i %><%= query.search ? '&search=' + query.search : '' %><%= query.category ? '&category=' + query.category : '' %>">
                                    <%= i %>
                                </a>
                            </li>
                        <% } %>

                        <% if (currentPage < totalPages) { %>
                            <li class="page-item">
                                <a class="page-link" href="?page=<%= currentPage + 1 %><%= query.search ? '&search=' + query.search : '' %><%= query.category ? '&category=' + query.category : '' %>">
                                    Next
                                </a>
                            </li>
                        <% } %>
                    </ul>
                </nav>
            <% } %>
        <% } else { %>
            <div class="text-center py-5">
                <i class="fas fa-box-open fa-3x text-muted mb-3"></i>
                <h5 class="text-muted">No products found</h5>
                <p class="text-muted">Try adjusting your search criteria or add a new product.</p>
                <a href="/products/new" class="btn btn-primary">
                    <i class="fas fa-plus me-2"></i>Add First Product
                </a>
            </div>
        <% } %>
    </div>
</div>

<style>
.product-thumbnail {
    width: 50px;
    height: 50px;
    object-fit: cover;
    border-radius: 5px;
}

.no-image {
    width: 50px;
    height: 50px;
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 5px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 10px;
    color: #6c757d;
}

.card {
    border: none;
    border-radius: 10px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
}

.card-header {
    background: #f8f9fa;
    border-bottom: 1px solid #e9ecef;
    border-radius: 10px 10px 0 0 !important;
}

.table th {
    border-top: none;
    font-weight: 600;
    color: #495057;
}

.btn-group .btn {
    border-radius: 6px !important;
}

.pagination .page-link {
    border-radius: 6px;
    margin: 0 2px;
}

.badge {
    font-size: 0.75rem;
}
</style>